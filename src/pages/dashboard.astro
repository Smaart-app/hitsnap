---
import Layout from '../layouts/Layout.astro';
import { createServerClient } from '@supabase/ssr';

const supabase = createServerClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.PUBLIC_SUPABASE_ANON_KEY,
  { cookies: Astro.cookies }
);

const url = new URL(Astro.request.url);
const tab = url.searchParams.get('tab') ?? 'all';

const { data: articles, error } = await supabase
  .from('articles')
  .select('*')
  .order('created_at', { ascending: false });

const publishedArticles = articles?.filter((a) => a.published) ?? [];
const drafts = articles?.filter((a) => !a.published) ?? [];

let visible = [];

if (tab === 'published') {
  visible = publishedArticles;
} else if (tab === 'drafts') {
  visible = drafts;
} else {
  visible = articles ?? [];
}
---

<Layout title="📋 Πίνακας Άρθρων">
  <main class="max-w-6xl mx-auto px-6 py-12">
