---
// File: /src/pages/[lang]/admin/new.astro
import Layout from '@layouts/Layout.astro';
import { createServerClientAstro } from '@/lib/createServerClientAstro';
import ArticleForm from '../../../components/editor/ArticleForm.astro';

export const prerender = false;

const lang = Astro.params.lang || 'el';

const supabase = createServerClientAstro(Astro.cookies);
const { data: { user } } = await supabase.auth.getUser();

if (!user || !user.id) {
  // Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ user Î® Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ id, redirect ÏƒÎµ login Î¼Îµ ÎºÎ±Î¸Î±ÏÏŒ session.
  return Astro.redirect(`/${lang}/admin/login`);
}

const pageTitle = lang === 'el' ? 'ÎÎ­Î¿ Î†ÏÎ¸ÏÎ¿' : 'New Article';
---

<Layout title={pageTitle} user={user}>
  <main class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6">ğŸ“ {pageTitle}</h1>

    <!-- 
    DEBUG Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿:
    <div style="background:#ffe8e8; color:#c00; margin-bottom:1rem; padding:8px; font-size:13px;">
      <b>DEBUG user prop (parent):</b>
      <pre>{JSON.stringify(user, null, 2)}</pre>
      <b>DEBUG lang param:</b> {lang}
    </div>
    -->

    <ArticleForm 
      user={user} 
      mode="new" 
      onSuccessUrl={`/${lang}/blog`} 
      lang={lang}
    />
  </main>
  
</Layout>
