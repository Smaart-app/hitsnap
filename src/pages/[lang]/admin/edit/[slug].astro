---
import EditorPage from '../../../../components/editor/EditorPage.astro';

const { slug, lang } = Astro.params;
import { createServerClientAstro } from '../../../../lib/createServerClient.ts';

const supabase = createServerClientAstro(Astro.cookies);

const [
  { data: { user }, error: userError },
  { data: article, error: articleError },
] = await Promise.all([
  supabase.auth.getUser(),
  supabase
    .from("articles")
    .select("*")
    .eq("slug", slug)
    .eq("lang", lang || 'el')
    .maybeSingle(),
]);

if (articleError) {
  return new Response(`âŒ Î£Ï†Î¬Î»Î¼Î± Supabase: ${articleError.message}`, { status: 500 });
}

if (!article) {
  return new Response(`ğŸ“­ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î¬ÏÎ¸ÏÎ¿ Î¼Îµ slug: ${slug}`, { status: 404 });
}

if (!user) {
  return new Response('ğŸ”’ Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚', { status: 401 });
}
---

<EditorPage user={user} article={article} />
