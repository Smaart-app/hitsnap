---
import EditorPage from '../../../../components/editor/EditorPage.astro';

const { slug, lang } = Astro.params;
import { createServerClientAstro } from '../../../../lib/createServerClient.ts';

const supabase = createServerClientAstro(Astro.cookies);

const [
  { data: { user }, error: userError },
  { data: article, error: articleError },
] = await Promise.all([
  supabase.auth.getUser(),
  supabase
    .from("articles")
    .select("*")
    .eq("slug", slug)
    .eq("lang", lang || 'el')
    .maybeSingle(),
]);

if (articleError) {
  return new Response(`❌ Σφάλμα Supabase: ${articleError.message}`, { status: 500 });
}

if (!article) {
  return new Response(`📭 Δεν βρέθηκε άρθρο με slug: ${slug}`, { status: 404 });
}

if (!user) {
  return new Response('🔒 Απαιτείται είσοδος', { status: 401 });
}
---

<EditorPage user={user} article={article} />
