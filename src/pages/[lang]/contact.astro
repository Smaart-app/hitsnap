---
export const prerender = false;

export async function getStaticPaths() {
  return [
    { params: { lang: "el" } },
    { params: { lang: "en" } },
  ];
}

import Layout from '../../layouts/Layout.astro';

const { lang } = Astro.params;
const isGreek = lang === 'el';
---

<Layout title={isGreek ? 'Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± â€” Hitlift' : 'Contact â€” Hitlift'} lang={lang}>
  <div class="relative isolate min-h-[80vh] flex flex-col justify-center items-center text-center px-6 py-32 overflow-hidden bg-[#f4f3f0]">

    <h1 class="text-4xl font-bold tracking-tight sm:text-5xl relative z-10">
      {isGreek ? 'Î•Ï€Î¹ÎºÎ¿Î¹Î½ÏÎ½Î·ÏƒÎµ Î¼Î±Î¶Î¯ Î¼Î¿Ï…' : 'Get in touch'}
    </h1>

    <p class="mt-6 text-lg leading-8 text-gray-600 max-w-xl mx-auto relative z-10">
      {isGreek
        ? 'Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ ÏƒÏ‡ÏŒÎ»Î¹Î±, Î¹Î´Î­ÎµÏ‚ Î® Î±Ï€Î»ÏÏ‚ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Ï€ÎµÎ¹Ï‚ Î­Î½Î± Î³ÎµÎ¹Î±, ÎµÎ¯Î¼Î±Î¹ ÎµÎ´Ï.'
        : 'If you have feedback, ideas, or just want to say hello, Iâ€™m all ears.'}
    </p>

    <form id="contact-form" class="mt-10 space-y-4 max-w-md w-full text-left relative z-10">
      <input
        name="name"
        type="text"
        placeholder={isGreek ? 'ÎŒÎ½Î¿Î¼Î± (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)' : 'Name (optional)'}
        class="w-full px-4 py-2 border rounded"
      />
      <input
        name="email"
        type="email"
        required
        placeholder={isGreek ? 'Î¤Î¿ email ÏƒÎ¿Ï…' : 'Your email'}
        class="w-full px-4 py-2 border rounded"
      />
      <textarea
        name="message"
        required
        placeholder={isGreek ? 'Î¤Î¿ Î¼Î®Î½Ï…Î¼Î¬ ÏƒÎ¿Ï…' : 'Your message'}
        class="w-full px-4 py-2 border rounded min-h-[120px]"
      ></textarea>
      <button
        type="submit"
        class="bg-[#50c7c2] text-white px-6 py-2 rounded hover:opacity-90 transition"
      >
        {isGreek ? 'Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®' : 'Send'}
      </button>
    </form>

    <p id="response-message" class="mt-4 text-sm text-center"></p>
  </div>

  <script is:client>
    import emailjs from 'emailjs-com';

    const isGreek = window.location.pathname.startsWith('/el');
    const form = document.getElementById('contact-form');
    const responseMsg = document.getElementById('response-message');

    if (!form) {
      console.error('âš ï¸ Î— Ï†ÏŒÏÎ¼Î± Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ DOM!');
    } else {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        responseMsg.textContent = '';

        const formData = new FormData(form);
        const payload = {
          name: formData.get('name') || '',
          email: formData.get('email') || '',
          message: formData.get('message') || ''
        };

        if (!payload.email || !payload.message) {
          responseMsg.textContent = isGreek
            ? 'âš ï¸ Î¤Î¿ email ÎºÎ±Î¹ Ï„Î¿ Î¼Î®Î½Ï…Î¼Î± ÎµÎ¯Î½Î±Î¹ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ¬.'
            : 'âš ï¸ Email and message are required.';
          return;
        }

        try {
          // Supabase insert
          const res = await fetch('/api/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const data = await res.json();

          if (!res.ok) {
            responseMsg.textContent = isGreek
              ? `âš ï¸ Î£Ï†Î¬Î»Î¼Î± Supabase: ${data.error || 'Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚.'}`
              : `âš ï¸ Supabase error: ${data.error || 'Message failed.'}`;
            return;
          }

          // EmailJS send from browser
          try {
            await emailjs.send(
              'service_rmsqduf',
              'template_ewoapex',
              payload,
              'Tfu4LjZEcoZIh-UtA'
            );

            responseMsg.textContent = isGreek
              ? 'ğŸ“¨ Î¤Î¿ Î¼Î®Î½Ï…Î¼Î¬ ÏƒÎ¿Ï… ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ Î¼Îµ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±!'
              : 'ğŸ“¨ Your message was sent successfully!';
            form.reset();
          } catch (emailError) {
            console.error('âŒ EmailJS error:', emailError);
            responseMsg.textContent = isGreek
              ? 'âš ï¸ Î¤Î¿ Î¼Î®Î½Ï…Î¼Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ Î±Î»Î»Î¬ Î´ÎµÎ½ ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ email.'
              : 'âš ï¸ Message saved but email not sent.';
          }

        } catch (err) {
          responseMsg.textContent = isGreek
            ? 'âš ï¸ Î ÏÏŒÎ²Î»Î·Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚.'
            : 'âš ï¸ Connection error.';
          console.error('âŒ Î£Ï†Î¬Î»Î¼Î±:', err);
        }
      });
    }
  </script>
</Layout>
