---
import Layout from '../../layouts/Layout.astro';
import ArticleCard from '../../components/ArticleCard.jsx';
import BackgroundSketch from '../../components/BackgroundSketch.astro';
import { createServerClientReadOnly } from '../../lib/createServerClient';

export async function getStaticPaths() {
  return [
    { params: { lang: 'el' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params;
const supportedLangs = ['el', 'en'];

if (!supportedLangs.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const supabase = createServerClientReadOnly(Astro.cookies);
const todayISO = new Date().toISOString();

const slugSuffix = `-${lang}`;

const { data: articles } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', todayISO)
  .order('publish_date', { ascending: false });

const featured =
  articles?.find((article) => article.slug.endsWith(slugSuffix)) || articles?.[0] || null;

const altLang = lang === 'el' ? 'en' : 'el';
const altHref = featured ? `/${altLang}/blog/${featured.slug}` : null;
---

<Layout title="Hitlift — The smart rise in real estate" lang={lang}>

  <!-- Sketch background framed as painting -->
  <section class="relative bg-[#f4f3f0] overflow-hidden">
    <div class="relative mx-auto w-[90vw] max-w-5xl h-[200px] pt-12 sm:pt-16 opacity-30 pointer-events-none">
      <BackgroundSketch />

      <!-- Framing lines -->
      <span class="absolute top-0 left-[1px] h-full w-[1px] bg-[#bbb] opacity-60"></span>
      <span class="absolute top-0 right-0 h-full w-[1px] bg-[#bbb] opacity-60"></span>
      <span class="absolute bottom-0 left-0 w-full h-[1px] bg-[#bbb] opacity-60"></span>
    </div>
  </section>

  <!-- Hero Title Section -->
  <section class="relative bg-[#f4f3f0] text-center px-6 pt-12 sm:pt-20 pb-20">
    <h1
      class="whitespace-pre-line text-4xl sm:text-5xl font-bold leading-tight mb-6 text-black"
      style="
        font-family: 'Playfair Display', serif;
        background-color: rgba(255,255,255,0.01);
        text-shadow: 0 0 0 #000;
      "
    >
      {lang === 'el'
        ? 'Δεν είναι μόνο το σπίτι.\nΕίναι η επιλογή.'
        : 'Looks good.'}
    </h1>

    <p class="text-lg text-zinc-800 dark:text-zinc-300 mb-10 font-medium">
      {lang === 'el'
        ? 'Ένα μέρος για όσους αναζητούν ουσία — όχι απλώς τετραγωνικά.'
        : 'But… does it really pay off?'}
    </p>

    <a
      href="/blog"
      class="inline-block bg-[#50c7c2] text-white px-6 py-3 rounded-full text-base font-semibold hover:bg-[#3db2b0] transition"
    >
      {lang === 'el' ? 'Ανακάλυψε τα άρθρα' : 'Read the articles'}
    </a>
  </section>

  <!-- Featured Article Section -->
  {featured ? (
    <section class="relative z-10 flex justify-center px-4 sm:px-6 pt-12 pb-24 bg-[#f4f3f0]">
      <div class="w-full max-w-screen-sm sm:max-w-xl text-center">
        <ArticleCard
          title={featured.title}
          excerpt={featured.excerpt}
          image={featured.image}
          href={`/${lang}/blog/${featured.slug}`}
          altHref={altHref}
          lang={lang}
        />
      </div>
    </section>
  ) : (
    <section class="relative z-10 text-center py-16 text-gray-500 bg-[#f4f3f0]">
      {lang === 'el'
        ? 'Δεν υπάρχει ακόμη προτεινόμενο άρθρο.'
        : 'No featured article available yet.'}
    </section>
  )}
</Layout>
