---
import Layout from '../../layouts/Layout.astro';
import { createServerClientReadOnly } from '../../lib/createServerClient';

export async function getStaticPaths() {
  return [
    { params: { lang: 'el' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params;
const supportedLangs = ['el', 'en'];

if (!supportedLangs.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const supabase = createServerClientReadOnly(Astro.cookies);
const todayISO = new Date().toISOString();

const { data: articles } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', todayISO)
  .order('publish_date', { ascending: false });

const featured = articles?.[0] || null;
const rest = featured ? articles.slice(1) : [];

const title = "Hitlift — The smart rise in real estate";
const description = lang === 'el'
  ? "Τι λείπει από τον τρόπο που αγοράζουμε και επενδύουμε σε ακίνητα; Η Hitlift εξερευνά τις απαντήσεις — άρθρο το άρθρο."
  : "What’s missing from the way we buy and invest in real estate? Hitlift explores the gaps — one article at a time.";

const image = "https://hitlift.app/preview-og-final.png?v=2";
---

<Layout title={title} lang={lang}>
  <head>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`https://hitlift.app/${lang}`} />
    <meta property="og:image" content={image} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />
  </head>

  <section class="bg-[#f4f3f0] pt-12 pb-20 px-4 sm:px-8 relative z-10">
    <div class="w-full flex justify-center mb-4 fade-in-up">
      <img 
        src="/assets/images/houses-sketch.png"
        alt="Χειροποίητο σκίτσο σπιτιών"
        class="w-full max-w-[720px] h-auto object-contain"
        style="aspect-ratio: 2.5 / 1;"
      />
    </div>

    <div class="w-full text-center mx-auto max-w-[520px] mb-10 px-4 fade-in-up" style="animation-delay: 0.2s;">
      <h1 class="text-[28px] sm:text-[32px] font-bold text-black leading-snug mb-1"
           style="font-family: 'Playfair Display', serif;">
        {lang === 'el'
          ? 'Φαίνεται καλό.'
          : 'Looks good.'}
      </h1>
      <p class="text-base text-gray-700 font-medium mb-5"
         style="font-family: 'Source Sans 3', sans-serif;">
        {lang === 'el'
          ? 'Αλλά... αξίζει στ’ αλήθεια;'
          : 'But… does it really pay off?'}
      </p>
      <img 
        src="/assets/images/puzzle-piece-dark.png"
        alt="Το κομμάτι που λείπει"
        class="mx-auto w-8 sm:w-10 opacity-80 hover:opacity-100 transition animate-float"
      />
    </div>

    {featured && (
      <div class="flex justify-center mb-12 fade-in-left" style="animation-delay: 0.4s;">
        <div class="bg-white shadow-md rounded-lg p-4 w-full max-w-md">
          <a href={`/${lang}/blog/${featured.slug}`} class="block hover:underline">
            <h2 class="text-lg font-bold text-gray-900 mb-1 leading-tight">{featured.title}</h2>
            <p class="text-sm text-gray-600 mb-2">{featured.excerpt?.split('.')[0] + '...'}</p>
            <span class="text-sm text-primary font-semibold">
              {lang === 'el' ? 'Δες περισσότερα →' : 'Read more →'}
            </span>
          </a>
        </div>
      </div>
    )}

    {rest.length > 0 && (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto px-4 fade-in-up" style="animation-delay: 0.6s;">
        {rest.map((article) => (
          <div class="bg-white rounded-md shadow-sm p-3">
            <a href={`/${lang}/blog/${article.slug}`} class="block hover:underline">
              <h3 class="text-sm font-semibold text-gray-900 mb-1">{article.title}</h3>
              <p class="text-sm text-gray-600 mb-2">{article.excerpt?.split('.')[0] + '...'}</p>
              <span class="text-sm text-[#50c7c2] font-medium">
                {lang === 'el' ? 'Περισσότερα →' : 'More →'}
              </span>
            </a>
          </div>
        ))}
      </div>
    )}

    {articles.length === 0 && (
      <section class="text-center py-16 text-gray-500 bg-[#f4f3f0]">
        {lang === 'el'
          ? 'Δεν υπάρχουν ακόμη άρθρα σε αυτή τη γλώσσα.'
          : 'No articles available in this language yet.'}
      </section>
    )}
  </section>
</Layout>
