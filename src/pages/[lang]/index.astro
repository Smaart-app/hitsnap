---
import Layout from '../../layouts/Layout.astro';
import BackgroundSketch from '../../components/BackgroundSketch.astro';
import ArticleCard from '../../components/ArticleCard.jsx';
import { createServerClientReadOnly } from '../../lib/createServerClient';

export async function getStaticPaths() {
  return [
    { params: { lang: 'el' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params;
const supportedLangs = ['el', 'en'];

if (!supportedLangs.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const supabase = createServerClientReadOnly(Astro.cookies);
const todayISO = new Date().toISOString();

const { data: articles } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', todayISO)
  .order('publish_date', { ascending: false })
  .limit(1);

const featured = articles?.[0] || null;
---

<Layout title="Hitlift — The smart rise in real estate" lang={lang}>
  <section class="relative z-10 flex flex-col justify-center items-center text-center pt-12 pb-12">
    <BackgroundSketch class="absolute inset-0 opacity-10 z-0" />

    <h1 class="text-4xl sm:text-5xl font-bold text-zinc-800 dark:text-zinc-100" style="font-family: 'Playfair Display', serif;">
      {lang === 'el' ? 'Φαίνεται καλό.' : 'Looks good.'}
    </h1>

    <p class="mt-4 text-lg sm:text-xl text-zinc-600 dark:text-zinc-300 font-light" style="font-family: 'Playfair Display', serif;">
      {lang === 'el'
        ? 'Αλλά… συμφέρει τελικά;'
        : 'But… does it really pay off?'}
    </p>

    {featured ? (
      <div class="mt-12 px-4 w-full max-w-3xl">
        <ArticleCard
          title={featured.title}
          excerpt={featured.excerpt}
          image={featured.image}
          href={`/${lang}/blog/${featured.slug}`}
          lang={lang}
        />
      </div>
    ) : (
      <p class="mt-12 text-sm text-gray-500">
        {lang === 'el'
          ? 'Δεν υπάρχει ακόμη προτεινόμενο άρθρο.'
          : 'No featured article available yet.'}
      </p>
    )}
  </section>
</Layout>
