---
import Layout from '../../layouts/Layout.astro';
import ArticleCard from '../../components/ArticleCard.jsx';
import { createServerClientReadOnly } from '../../lib/createServerClient';

export async function getStaticPaths() {
  return [
    { params: { lang: 'el' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params;
const supportedLangs = ['el', 'en'];

if (!supportedLangs.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const supabase = createServerClientReadOnly(Astro.cookies);
const todayISO = new Date().toISOString();
const slugSuffix = `-${lang}`;

const { data: articles } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', todayISO)
  .order('publish_date', { ascending: false });

const featured = articles?.find((article) => article.slug.endsWith(slugSuffix)) || articles?.[0] || null;
const altLang = lang === 'el' ? 'en' : 'el';
const altHref = featured ? `/${altLang}/blog/${featured.slug}` : null;
---

<Layout title="Hitlift — The smart rise in real estate" lang={lang}>
  <section class="bg-[#f4f3f0] pt-12 pb-20 px-4 sm:px-8 relative z-10">
    
    <!-- Εικόνα -->
    <div class="w-full flex justify-center mb-4">
      <img 
        src="/assets/images/houses-sketch.png"
        alt="Χειροποίητο σκίτσο σπιτιών"
        class="w-full max-w-[720px] h-auto object-contain"
        style="aspect-ratio: 2.5 / 1;"
      />
    </div>

    <!-- Κείμενο + άρθρο σε δύο στήλες -->
    <div class="w-full max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 items-start mt-8 px-4">
      <!-- Featured άρθρο (αριστερά) -->
      {featured && (
        <div class="md:col-span-1 w-full max-w-sm bg-white shadow-sm rounded-lg p-4">
          <ArticleCard 
            title={featured.title}
            excerpt={featured.excerpt?.slice(0, 140) + '…'} 
            image={featured.image}
            href={`/${lang}/blog/${featured.slug}`}
            altHref={altHref}
            lang={lang}
          />
        </div>
      )}

      <!-- Κεντρικός τίτλος (στο κέντρο των 2 στηλών) -->
      <div class="md:col-span-2 text-center md:text-left flex flex-col justify-center items-start md:items-center px-2">
        <h1 class="text-[28px] sm:text-[32px] font-bold text-black leading-snug mt-4 mb-1" style="font-family: 'Playfair Display', serif;">
          {lang === 'el' ? 'Δεν είναι μόνο το σπίτι.\nΕίναι η επιλογή.' : 'Looks good.'}
        </h1>
        <p class="text-base font-medium" style="font-family: 'Source Sans 3', sans-serif; color: #1a1a1a;">
          {lang === 'el' ? 'Ένα μέρος για όσους αναζητούν ουσία — όχι απλώς τετραγωνικά.' : 'But… does it really pay off?'}
        </p>
      </div>
    </div>
  </section>

  {!featured && (
    <section class="relative z-10 text-center py-16 text-gray-500 bg-[#f4f3f0]">
      {lang === 'el' ? 'Δεν υπάρχει ακόμη προτεινόμενο άρθρο.' : 'No featured article available yet.'}
    </section>
  )}
</Layout>
