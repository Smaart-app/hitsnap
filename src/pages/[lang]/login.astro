---
// src/pages/[lang]/login.astro
import Layout from '@layouts/Layout.astro';
import LoginForm from '../../components/LoginForm.jsx';
import { isFsMode } from '@/lib/isFsMode';
import { createServerClient } from '@/lib/createServerClientAstro';

export const prerender = false;

const lang = (Astro.params?.lang as string) || 'en';
const fsMode = isFsMode();

// FS-MODE: Î¼Î·Î½ Î±Î³Î³Î¯Î¶ÎµÎ¹Ï‚ Supabase ÏƒÏ„Î·Î½ server Ï€Î»ÎµÏ…ÏÎ¬, Î­Î»ÎµÎ³Î¾Îµ Î¼ÏŒÎ½Î¿ Ï„Î¿ demo cookie
if (fsMode) {
  const logged = Astro.cookies.get('fs-auth')?.value === '1';
  if (logged) {
    return Astro.redirect(`/${lang}/admin/preview`);
  }
} else {
  // Real backend: ÎºÎ»Î±ÏƒÎ¹ÎºÏŒÏ‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Supabase session
  const supabase = createServerClient(Astro.cookies);
  const { data: { session } } = await supabase.auth.getSession();
  if (session) {
    return Astro.redirect(`/${lang}/admin/preview`);
  }
}

const pageTitle = lang === 'el' ? 'ğŸ” Î•Î¯ÏƒÎ¿Î´Î¿Ï‚' : 'ğŸ” Sign In';
---

<Layout title={pageTitle} lang={lang}>
  <main class="max-w-md mx-auto mt-24 p-6 bg-white rounded shadow">
    <h1 class="text-2xl font-bold mb-4">
      {lang === 'el' ? 'ğŸ” Î£ÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î¿ Admin' : 'ğŸ” Sign in to Admin'}
    </h1>

    {fsMode && (
      <p class="text-sm text-zinc-600 mb-3">
        Demo mode: Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Î³Î¯Î½ÎµÏ„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬. Î— Ï†ÏŒÏÎ¼Î± Î¸Î± ÏƒÎµ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹ Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ backend.
      </p>
    )}

    <LoginForm lang={lang} client:load />
  </main>
</Layout>
