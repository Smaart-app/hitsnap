---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((article) => ({
    params: {
      lang: article.data.lang,
      slug: article.slug,
    },
  }));
}

export const prerender = false;

const { slug, lang } = Astro.params;

const articles = await getCollection('articles');
const article = articles.find(
  (a) => a.slug === slug && a.data.lang === lang
);

const pageTitle = article?.data.title ?? 'Î†Î³Î½Ï‰ÏƒÏ„Î¿ Î¬ÏÎ¸ÏÎ¿';
const pageDescription = article?.data.excerpt ?? 'ÎœÎ¬Î»Î»Î¿Î½ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î¼ÎµÏ„Î±ÎºÏŒÎ¼Î¹ÏƒÎµ...';
const pageUrl = `https://hitlift.gr/blog/${slug}`;
---

<Layout title={pageTitle}>
  <head slot="head">
    <meta name="description" content={pageDescription} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:type" content="article" />
    <meta property="og:url" content={pageUrl} />
  </head>

  {article ? (
    <article class="prose prose-zinc dark:prose-invert max-w-3xl mx-auto py-12 px-4">
      <h1 class="mb-4">{article.data.title}</h1>
      <p class="text-sm text-zinc-500 mb-4">
        {new Date(article.data.date).toLocaleDateString(lang === "en" ? "en-GB" : "el-GR")}
      </p>

      {article.data.image && (
        <div class="flex justify-center">
          <img
            src={article.data.image}
            alt="Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…"
            class="mb-6 max-h-[400px] w-auto max-w-full object-contain rounded-lg shadow"
          />
        </div>
      )}

      {@html article.body}

      <div class="mt-12 text-center mb-24">
        <a href={`/blog`} class="inline-block text-[#50c7c2] hover:underline">
          â† Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ blog
        </a>
      </div>

      <!-- ğŸ‘‡ DEBUG BLOCK -->
      <details class="mt-8 bg-zinc-100 text-xs p-4 rounded shadow text-black">
        <summary class="cursor-pointer">ğŸ›  Î”ÎµÎ¯Ï„Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (debug)</summary>
        <pre class="overflow-auto whitespace-pre-wrap">
{JSON.stringify(article, null, 2)}
        </pre>
      </details>
    </article>
  ) : (
    <section class="text-center py-24">
      <h1 class="text-4xl font-bold mb-4">Î¤Î¿ Î¬ÏÎ¸ÏÎ¿ Ï‡Î¬Î¸Î·ÎºÎµ ÏƒÏ„Î± Ï„ÎµÏ„ÏÎ±Î³Ï‰Î½Î¹ÎºÎ¬ ğŸšï¸</h1>
      <p class="text-gray-600 dark:text-gray-400 mb-8">
        Î‰ Î´ÎµÎ½ Ï…Ï€Î®ÏÎ¾Îµ Ï€Î¿Ï„Î­, Î® ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ Ï„Î¿ Î­Î²Î±Î»Îµ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿ Ï‡Î±Î»Î¯.
      </p>
      <a
        href={`/blog`}
        class="inline-block bg-[#50c7c2] text-white px-6 py-3 rounded-lg shadow hover:bg-[#3db2b0] transition"
      >
        ğŸ  Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î¿ blog
      </a>
    </section>
  )}
</Layout>
