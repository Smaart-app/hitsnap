---
// src/pages/[lang]/blog/index.astro
import Layout from '../../../layouts/Layout.astro';
import ArticleCard from '../../../components/ArticleCard.jsx';
import { getBackend } from '@/lib/backend';

export const prerender = false;

const { lang } = Astro.params as { lang: string };
const backend = getBackend();

// Δημόσια λίστα: μόνο όσα είναι ορατά τώρα (όχι drafts, όχι future scheduled)
const articlesFs = await backend.articles.list({
  language: lang,
  includeDrafts: false,
});

// Προσαρμογή στα πεδία που περιμένει το UI σου (cover_image κ.λπ.)
const articles = (articlesFs ?? []).map((a) => ({
  title: a.title,
  excerpt: a.excerpt ?? '',
  slug: a.slug,
  // Το ArticleCard περιμένει cover_image
  cover_image: a.coverImage ?? '',
  // κρατάμε για συμβατότητα αν κάπου αλλού το χρησιμοποιήσεις
  publish_date: a.publishDate,
  published: a.status === 'published',
  lang: a.language ?? lang,
}));

const pageTitle = lang === 'en' ? 'Articles | HitSnap' : 'Άρθρα | HitSnap';
const pageDesc =
  lang === 'en'
    ? 'Fresh posts from HitSnap on photography, the creative process, and product updates.'
    : 'Πρόσφατα άρθρα του HitSnap για φωτογραφία, δημιουργική διαδικασία και νέα του project.';
---

<Layout title={pageTitle} lang={lang}>
  <head slot="head">
    <meta charset="UTF-8" />
    <meta name="description" content={pageDesc} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDesc} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/preview-og-final.png" />
    <title>{pageTitle}</title>
  </head>

  <main class="max-w-6xl mx-auto px-4 py-16">
    <h1 class="text-3xl font-bold text-center mb-10">
      {lang === 'en' ? 'Articles' : 'Άρθρα'}
    </h1>

    {articles.length === 0 ? (
      <p class="text-center text-zinc-500 text-lg">
        {lang === 'en'
          ? 'No articles found.'
          : 'Δεν υπάρχουν άρθρα προς εμφάνιση.'}
      </p>
    ) : (
      <section class="grid gap-12 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
        {articles.map((article) => (
          <ArticleCard
            client:load
            title={article.title}
            excerpt={article.excerpt}
            image={article.cover_image}
            href={`/${lang}/blog/${article.slug}`}
            lang={lang}
            altHref={`/${lang === 'el' ? 'en' : 'el'}/blog/${article.slug}`}
          />
        ))}
      </section>
    )}
  </main>
</Layout>
