---
import Layout from '../../../layouts/Layout.astro';
import ArticleCard from '../../../components/ArticleCard.jsx';
// Î•Î”Î© Î· Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·:
import { createServerClientAstro } from '../../../lib/createServerClient.ts';

// ğŸš¨ ÎœÎµÏ„Î±Ï„ÏÎ­Ï€Î¿Ï…Î¼Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± ÏƒÎµ Server-rendered
export const prerender = false;

const { lang } = Astro.params;
// Î•Î”Î© Î· Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·:
const supabase = createServerClientAstro(Astro.cookies);

const now = new Date().toISOString();

const { data: articles, error } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', now)
  .order('publish_date', { ascending: false });

const pageTitle = lang === 'en' ? 'Articles | Hitlift' : 'Î†ÏÎ¸ÏÎ± | Hitlift';
const pageDesc =
  lang === 'en'
    ? 'Explore the latest articles from Hitlift about real estate, strategy and clarity.'
    : 'Î”ÎµÏ‚ Ï„Î± Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î¬ÏÎ¸ÏÎ± Ï„Î·Ï‚ Hitlift Î³Î¹Î± Î±ÎºÎ¯Î½Î·Ï„Î±, ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ® ÎºÎ±Î¹ ÎºÎ±Î¸Î±ÏÎ® ÏƒÎºÎ­ÏˆÎ·.';
---

<Layout title={pageTitle} lang={lang}>
  <head slot="head">
    <meta charset="UTF-8" />
    <meta name="description" content={pageDesc} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDesc} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/preview-image.png" />
    <title>{pageTitle}</title>
  </head>

  <main class="max-w-6xl mx-auto px-4 py-16">
    <h1 class="text-3xl font-bold text-center mb-10">
      {lang === 'en' ? 'Articles' : 'Î†ÏÎ¸ÏÎ±'}
    </h1>

    {articles?.length === 0 ? (
      <p class="text-center text-zinc-500">
        {lang === 'en' ? 'No articles found.' : 'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¬ÏÎ¸ÏÎ± Ï€ÏÎ¿Ï‚ ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·.'}
      </p>
    ) : (
      <section class="grid gap-12 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
        {articles.map((article) => (
          <ArticleCard
            client:load
            title={article.title}
            excerpt={article.excerpt}
            image={article.cover_image}
            href={`/${lang}/blog/${article.slug}`}
            lang={lang}
            altHref={`/${lang === 'el' ? 'en' : 'el'}/blog/${article.slug}`}
          />
        ))}
      </section>
    )}
  </main>
</Layout>
