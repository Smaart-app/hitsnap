---
import { createClient } from '@supabase/supabase-js';
import { serialize } from 'cookie';

export const prerender = false;

const supabase = createClient(
  import.meta.env.PUBLIC_SUPABASE_URL,
  import.meta.env.PUBLIC_SUPABASE_ANON_KEY
);

// Κάνε logout από Supabase
await supabase.auth.signOut();

// Από τη διαδρομή π.χ. /el/logout → πάρε το 'el'
const url = new URL(Astro.request.url);
const rawSegment = url.pathname.split('/')[1];
const lang = ['el', 'en'].includes(rawSegment) ? rawSegment : 'el';

// Δημιουργία headers για redirect + καθαρισμό cookies
const headers = new Headers();
headers.set('Location', `/${lang}/login`);
headers.append('Set-Cookie', serialize('sb-access-token', '', {
  path: '/',
  maxAge: 0,
  httpOnly: true,
  sameSite: 'Lax'
}));
headers.append('Set-Cookie', serialize('sb-refresh-token', '', {
  path: '/',
  maxAge: 0,
  httpOnly: true,
  sameSite: 'Lax'
}));

return new Response(null, {
  status: 302,
  headers
});
---