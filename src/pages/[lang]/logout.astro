---
import { createServerClient } from '@/lib/createServerClientAstro'
import { serialize } from 'cookie'

export const prerender = false

const supabase = createServerClient(Astro.cookies)

// logout από Supabase (server-side – δεν ρίχνει error αν δεν υπάρχει session)
await supabase.auth.signOut()

// πιάσε τη γλώσσα από το URL (π.χ. /el/logout -> el)
const url = new URL(Astro.request.url)
const rawSegment = url.pathname.split('/')[1]
const lang = ['en', 'nl', 'el'].includes(rawSegment) ? rawSegment : 'en'

// headers για redirect + καθάρισμα cookies
const headers = new Headers()
headers.set('Location', `/${lang}/login`)

headers.append(
  'Set-Cookie',
  serialize('sb-access-token', '', {
    path: '/',
    maxAge: 0,
    httpOnly: true,
    sameSite: 'Lax',
  })
)
headers.append(
  'Set-Cookie',
  serialize('sb-refresh-token', '', {
    path: '/',
    maxAge: 0,
    httpOnly: true,
    sameSite: 'Lax',
  })
)

return new Response(null, { status: 302, headers })
---
