---
import Layout from '../../layouts/Layout.astro';
import BackgroundSketch from '../../components/BackgroundSketch.astro';
import ArticleCard from '../../components/ArticleCard.jsx';
import { getPublishedArticles } from '../../utils/getArticles';

const url = new URL(Astro.request.url);
const tab = url.searchParams.get('tab') ?? 'all';
const isDev = import.meta.env.MODE === 'development';

if (!isDev) {
  const key = url.searchParams.get('key');
  const allowedKey = 'my-secret-key';
  if (key !== allowedKey) {
    return Astro.redirect('/');
  }
}

const posts = await getPublishedArticles();
console.log("ğŸ“¦ Articles:", posts);
---

<Layout>
  <BackgroundSketch />

  <header class="text-center max-w-3xl mx-auto py-32 px-4">
    <h1 class="text-4xl sm:text-5xl font-serif mb-6">Î— ÎšÎ±Ï„Î¿Î¹ÎºÎ¯Î± Î©Ï‚ Î•Ï€Î¹Î»Î¿Î³Î®</h1>
    <p class="text-lg text-gray-600">
      Î£ÎºÎ­ÏˆÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Î³Î¹Î± ÎµÎºÎµÎ¯Î½Î¿Ï…Ï‚ Ï€Î¿Ï… Î´ÎµÎ½ Î¸Î­Î»Î¿Ï…Î½ Î½Î± Î±Î³Î¿ÏÎ¬ÏƒÎ¿Ï…Î½ Î±Ï€Î»ÏÏ‚ Î­Î½Î± Î±ÎºÎ¯Î½Î·Ï„Î¿,
      Î±Î»Î»Î¬ Î½Î± ÎºÎ±Ï„Î±Î»Î¬Î²Î¿Ï…Î½ Ï„Î¹ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹.
    </p>
  </header>

  <main class="max-w-3xl mx-auto px-4 space-y-16 pb-32">
    {posts.length > 0 ? (
      posts.map((post) => (
        <ArticleCard 
          title={post.title} 
          excerpt={post.excerpt} 
          slug={post.slug} 
        />
      ))
    ) : (
      <p class="text-center text-gray-500">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î¬ÏÎ¸ÏÎ± Ï€ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½.</p>
    )}
  </main>
</Layout>
