---
import Layout from '../../../layouts/Layout.astro'
import EditorPage from '../../../components/editor/EditorPage.astro'
import { createServerClientWithCookies } from '../../../lib/createServerClient.ts'

const { slug } = Astro.params

const supabase = createServerClientWithCookies(Astro.cookies)

const { data, error } = await supabase
  .from('articles')
  .select('*')
  .eq('slug', slug)
  .limit(1)

console.log('ğŸ” Slug:', slug)
console.log('ğŸ§¾ Supabase result:', data)
console.log('âš ï¸ Error:', error)

const article = data?.[0] ?? null
---

<Layout title={`Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± - ${article?.title || slug}`}>
  <main class="max-w-3xl mx-auto px-4 py-16">
    {article ? (
      <EditorPage article={article} />
    ) : (
      <p class="text-red-600 text-center text-lg font-semibold">
        âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î¬ÏÎ¸ÏÎ¿ Î¼Îµ slug: <code>{slug}</code>
      </p>
    )}
  </main>
</Layout>