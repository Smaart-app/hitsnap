---
const user = Astro.props?.user || null;

function getLangFromPath(pathname) {
  const match = pathname.match(/^\/(el|en)(\/|$)/);
  return match?.[1] || 'el';
}

const currentPath = Astro.url.pathname;
const lang = getLangFromPath(currentPath);

const isGreek = lang === 'el';
const base = isGreek ? '/el' : '/en';

const isHome = currentPath === '/';
const isArticles = currentPath.includes('/blog') && !currentPath.includes('/editor');
const isContact = currentPath.includes('/contact');
const isDashboard = currentPath.includes('/dashboard');
const isEditor = currentPath.includes('/editor');

const pathWithoutLang = currentPath.replace(/^\/(el|en)/, '');
const pathForGreek = `/el${pathWithoutLang}`;
const pathForEnglish = `/en${pathWithoutLang}`;
---

<header class="w-full border-b border-zinc-200 bg-white dark:bg-zinc-950 shadow-sm px-4 sm:px-6 py-3 sm:py-4">
  <div class="max-w-screen-xl mx-auto flex flex-wrap items-center justify-between gap-y-2">
    <!-- Λογότυπο -->
    <a href="/" class="text-3xl tracking-tight flex items-center leading-none" style="font-family: 'Lora', serif;">
      <span class="font-bold text-black dark:text-white">Hit</span>
      <span class="font-normal text-[#50c7c2] ml-1">lift</span>
    </a>

    <!-- Πλοήγηση -->
    <nav class="flex flex-wrap items-center gap-4 sm:gap-6 text-sm sm:text-base font-medium text-zinc-700 dark:text-zinc-300">
      <a href="/" class={`${isHome ? 'text-[#50c7c2] font-bold' : 'hover:text-[#50c7c2]'} transition`}>
        {isGreek ? 'Αρχική' : 'Home'}
      </a>
      <a href={`${base}/blog`} class={`${isArticles ? 'text-[#50c7c2] font-bold' : 'hover:text-[#50c7c2]'} transition`}>
        {isGreek ? 'Άρθρα' : 'Articles'}
      </a>
      <a href={`${base}/contact`} class={`${isContact ? 'text-[#50c7c2] font-bold' : 'hover:text-[#50c7c2]'} transition`}>
        {isGreek ? 'Επικοινωνία' : 'Contact'}
      </a>

      <!-- Γλώσσα & θέμα -->
      <div class="ml-1 sm:ml-2 flex items-center gap-3 text-sm sm:text-base">
        {isGreek ? (
          <a href={pathForEnglish} aria-label="Switch to English" class="hover:text-[#50c7c2]">
            English 🇬🇧
          </a>
        ) : (
          <a href={pathForGreek} aria-label="Μετάβαση στα Ελληνικά" class="hover:text-[#50c7c2]">
            Ελληνικά 🇬🇷
          </a>
        )}

        <button
          id="toggle-theme"
          class="text-lg opacity-70 hover:opacity-100 transition"
          title={isGreek ? 'Εναλλαγή θέματος' : 'Toggle theme'}
        >
          🌓
        </button>
      </div>

      <!-- Ενέργειες -->
      {user ? (
        <>
          <a href="/dashboard" class={`${isDashboard ? 'text-[#50c7c2] font-bold' : 'hover:text-[#50c7c2]'} transition`}>
            📋 {isGreek ? 'Πίνακας' : 'Dashboard'}
          </a>
          <a href={`${base}/blog/editor`} class={`${isEditor ? 'text-[#50c7c2] font-bold' : 'hover:text-[#50c7c2]'} transition`}>
            📝 {isGreek ? 'Επεξεργασία' : 'Editor'}
          </a>
          <a href="/api/logout" class="text-red-600 hover:underline">
            🚪 {isGreek ? 'Αποσύνδεση' : 'Logout'}
          </a>
        </>
      ) : (
        <a href="/login" class="text-[#50c7c2] hover:underline">
          🔐 {isGreek ? 'Είσοδος' : 'Login'}
        </a>
      )}
    </nav>
  </div>
</header>
