---
import Layout from '../../layouts/Layout.astro';
import BackgroundSketch from '../../components/BackgroundSketch.astro';
import { createServerClientReadOnly } from '../../lib/createServerClient';

export async function getStaticPaths() {
  return [
    { params: { lang: 'el' } },
    { params: { lang: 'en' } },
  ];
}

const { lang } = Astro.params;
const supportedLangs = ['el', 'en'];

if (!supportedLangs.includes(lang)) {
  throw new Error(`Unsupported language: ${lang}`);
}

const supabase = createServerClientReadOnly(Astro.cookies);

const {
  data: { user }
} = await supabase.auth.getUser();

const todayISO = new Date().toISOString();

const { data: articles, error } = await supabase
  .from('articles')
  .select('*')
  .eq('lang', lang)
  .eq('published', true)
  .lte('publish_date', todayISO)
  .order('publish_date', { ascending: false })
  .limit(1);

const featured = articles?.[0] || null;

// ğŸŸ¡ DEBUG LOGS ÏƒÏ„Î¿ terminal
console.log('ğŸŸ¡ DEBUG lang:', lang);
console.log('ğŸŸ¡ DEBUG featured:', featured);
console.log('ğŸŸ¡ DEBUG error:', error);
---

<Layout title="Hitlift â€” Î— ÎˆÎ¾Ï…Ï€Î½Î· Î†Î½Î¿Î´Î¿Ï‚ ÏƒÏ„Î¿ Real Estate" lang={lang} user={user}>
  <div class="relative isolate min-h-[80vh] flex flex-col justify-center items-center text-center px-6 py-32 overflow-hidden bg-[#f4f3f0]">
    <BackgroundSketch class="absolute inset-0 opacity-10 z-0" />

    <h1 class="text-4xl font-bold tracking-tight sm:text-5xl relative z-10">
      {lang === 'el'
        ? 'Î¦Î±Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ±Î»ÏŒ. Î‘Î»Î»Î¬... ÏŒÎ½Ï„Ï‰Ï‚ ÏƒÏ…Î¼Ï†Î­ÏÎµÎ¹;'
        : 'Looks good. Butâ€¦ does it really pay off?'}
    </h1>

    <p class="mt-6 text-lg leading-8 text-gray-600 max-w-xl mx-auto relative z-10">
      {lang === 'el'
        ? 'Î— ÎµÏÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… Î¼Î­Î½ÎµÎ¹, ÏŒÏ„Î±Î½ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î± Î¼Î¿Î¹Î¬Î¶Î¿Ï…Î½ ÏƒÏ‰ÏƒÏ„Î¬.'
        : 'The question that remains, when everything else looks right.'}
    </p>

    {featured ? (
      <div class="mt-16 max-w-xl w-full bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-left relative z-10">
        <h2 class="text-xl font-bold mb-2">{featured.title}</h2>
        <p class="text-gray-700 text-sm mb-4">{featured.excerpt}</p>
        <a
          href={`/${featured.lang}/blog/${featured.slug}`}
          class="text-[#50c7c2] text-sm hover:underline"
        >
          {featured.lang === 'el' ? 'Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± â†’' : 'Read more â†’'}
        </a>
      </div>
    ) : (
      <p class="mt-12 text-gray-500 text-sm z-10 relative">
        {lang === 'el'
          ? 'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î±ÎºÏŒÎ¼Î· Ï€ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î¿ Î¬ÏÎ¸ÏÎ¿.'
          : 'No featured article available yet.'}
      </p>
    )}
  </div>
</Layout>
